<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∏–≤–µ—Ç –æ—Ç –ù–∏–∫–∏—Ç—ã</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="emoji">üëã</div>
        <h1>–ü—Ä–∏–≤–µ—Ç, —è –ù–∏–∫–∏—Ç–∞</h1>
        
        <div class="form-section">
            <div class="form-group">
                <label for="textInput">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
                <textarea id="textInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="excludeInput">–°–ª–æ–≤–∞ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
                <input type="text" id="excludeInput" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–∏–≤–µ—Ç, –º–∏—Ä">
                <div class="info-text">–ë—É–¥—É—Ç –∏—Å–∫–ª—é—á–µ–Ω—ã —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ –æ–¥–Ω–æ–∫–æ—Ä–µ–Ω–Ω—ã–µ –∏–º</div>
            </div>
            
            <button class="btn" onclick="processText()">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
            
            <div id="result" class="result">
                <div class="result-label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
                <div class="result-text" id="resultText"></div>
            </div>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ—Ä–Ω—è —Å–ª–æ–≤–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º)
        function getWordRoot(word) {
            word = word.toLowerCase().trim();
            if (word.length <= 3) return word;
            
            // –£–±–∏—Ä–∞–µ–º —Ç–∏–ø–∏—á–Ω—ã–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
            const endings = ['—ã–π', '–∞—è', '–æ–µ', '—ã–µ', '–æ–π', '–µ–π', '–æ–º', '–µ–º', '—É—é', '—É—é', 
                           '–æ–≤', '–µ–≤', '–∏–Ω', '—ã–Ω', '—ã—Ö', '–∏—Ö', '–∞–º', '—è–º', '–∞–º–∏', '—è–º–∏',
                           '–∞—Ö', '—è—Ö', '–∏', '—ã', '–∞', '–æ', '–µ', '—É', '—é', '—å', '—ä'];
            
            // –ü—Ä–æ–±—É–µ–º —É–±—Ä–∞—Ç—å –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–∑–Ω–æ–π –¥–ª–∏–Ω—ã
            for (let len = 3; len >= 1; len--) {
                if (word.length > len) {
                    const ending = word.slice(-len);
                    if (endings.includes(ending)) {
                        return word.slice(0, -len);
                    }
                }
            }
            
            // –ï—Å–ª–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–µ 4-5 —Å–∏–º–≤–æ–ª–æ–≤ –∫–∞–∫ –∫–æ—Ä–µ–Ω—å
            return word.slice(0, Math.max(4, word.length - 2));
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è—é—Ç—Å—è –ª–∏ —Å–ª–æ–≤–∞ –æ–¥–Ω–æ–∫–æ—Ä–µ–Ω–Ω—ã–º–∏
        function areRelatedWords(word1, word2) {
            const root1 = getWordRoot(word1);
            const root2 = getWordRoot(word2);
            
            // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–æ—Ä–Ω–∏
            if (root1 === root2) return true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –æ–¥–∏–Ω –∫–æ—Ä–µ–Ω—å –¥—Ä—É–≥–æ–π (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)
            if (root1.length >= 4 && root2.length >= 4) {
                if (root1.includes(root2) || root2.includes(root1)) {
                    return true;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–π –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª–∏–Ω–æ–π 4+ —Å–∏–º–≤–æ–ª–æ–≤
            let commonPrefix = '';
            const minLen = Math.min(root1.length, root2.length);
            for (let i = 0; i < minLen; i++) {
                if (root1[i] === root2[i]) {
                    commonPrefix += root1[i];
                } else {
                    break;
                }
            }
            
            return commonPrefix.length >= 4;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ (–∞–ª–≥–æ—Ä–∏—Ç–º –§–∏—à–µ—Ä–∞-–ô–µ—Ç—Å–∞)
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞
        function processText() {
            const textInput = document.getElementById('textInput').value.trim();
            const excludeInput = document.getElementById('excludeInput').value.trim();
            const resultDiv = document.getElementById('result');
            const resultText = document.getElementById('resultText');
            
            if (!textInput) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');
                return;
            }
            
            // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å–ª–æ–≤–∞
            const words = textInput.split(/\s+/).filter(word => word.length > 0);
            
            if (words.length === 0) {
                alert('–¢–µ–∫—Å—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è
            const excludeWords = excludeInput
                .split(',')
                .map(word => word.trim().toLowerCase())
                .filter(word => word.length > 0);
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª–æ–≤–∞: –∏—Å–∫–ª—é—á–∞–µ–º —É–∫–∞–∑–∞–Ω–Ω—ã–µ –∏ –æ–¥–Ω–æ–∫–æ—Ä–µ–Ω–Ω—ã–µ
            let filteredWords = words.filter(word => {
                const wordLower = word.toLowerCase();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                if (excludeWords.includes(wordLower)) {
                    return false;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–¥–Ω–æ–∫–æ—Ä–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
                for (const excludeWord of excludeWords) {
                    if (areRelatedWords(wordLower, excludeWord)) {
                        return false;
                    }
                }
                
                return true;
            });
            
            if (filteredWords.length === 0) {
                resultText.textContent = '–í—Å–µ —Å–ª–æ–≤–∞ –±—ã–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç.';
                resultDiv.classList.add('show');
                return;
            }
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Å–ª–æ–≤–∞
            const shuffledWords = shuffleArray(filteredWords);
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Å–æ—Ö—Ä–∞–Ω—è—è –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
            let result = '';
            let wordIndex = 0;
            const originalWords = textInput.split(/(\s+)/);
            
            for (let i = 0; i < originalWords.length; i++) {
                const segment = originalWords[i];
                if (segment.trim().length > 0 && !/^\s+$/.test(segment)) {
                    // –≠—Ç–æ —Å–ª–æ–≤–æ
                    if (wordIndex < shuffledWords.length) {
                        result += shuffledWords[wordIndex];
                        wordIndex++;
                    }
                } else {
                    // –≠—Ç–æ –ø—Ä–æ–±–µ–ª—ã –∏–ª–∏ –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
                    result += segment;
                }
            }
            
            // –ï—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å —Å–ª–æ–≤–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–∏–∑-–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π)
            while (wordIndex < shuffledWords.length) {
                result += (result ? ' ' : '') + shuffledWords[wordIndex];
                wordIndex++;
            }
            
            // –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            resultText.textContent = result || '–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç';
            resultDiv.classList.add('show');
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
        document.getElementById('textInput').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                processText();
            }
        });
        
        document.getElementById('excludeInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                processText();
            }
        });
    </script>
</body>
</html>
