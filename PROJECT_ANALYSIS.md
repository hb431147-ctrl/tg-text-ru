# Анализ проекта и план исправления

## Выявленные проблемы

### 1. Конфликт процессов деплоя
**Проблема:**
- `deploy.ps1` делает локальную сборку React (строки 186-208)
- `deploy.ps1` также копирует файлы напрямую через `rsync` (строки 121-133)
- `post-receive` делает сборку на сервере и копирует из `dist/`
- Два процесса могут конфликтовать и перезаписывать друг друга

**Последствие:** После деплоя в `public_html` попадает старый `index.html` вместо собранного

### 2. API возвращает 404 через Nginx
**Проблема:**
- Express API работает локально (проверено: `curl localhost:5000/api/auth/register` возвращает JSON)
- Запросы доходят до Express (видно в `journalctl`)
- Но через Nginx возвращается 404 с HTML вместо JSON

**Возможные причины:**
- Nginx перехватывает ошибку и возвращает свою HTML страницу
- Проблема с проксированием `/api/` запросов
- Express не обрабатывает маршрут правильно при проксировании

### 3. Архитектурные проблемы
- `app.js` находится в корне проекта вместе с React кодом
- Нет четкого разделения frontend/backend
- Два процесса сборки (локально и на сервере) создают неопределенность

## План исправления

### Шаг 1: Упростить процесс деплоя
- Убрать локальную сборку из `deploy.ps1`
- Оставить только сборку на сервере через `post-receive`
- Убрать прямое копирование файлов из `deploy.ps1`

### Шаг 2: Исправить API проксирование
- Проверить, что все запросы к `/api/` правильно проксируются
- Убедиться, что Express всегда возвращает JSON для API endpoints
- Добавить явную обработку ошибок в Express

### Шаг 3: Улучшить структуру проекта
- Разделить frontend и backend
- Создать четкий процесс деплоя

## Текущий статус

✅ React приложение собирается правильно на сервере
✅ Express API работает локально
❌ API возвращает 404 через Nginx
❌ После деплоя React файлы перезаписываются

