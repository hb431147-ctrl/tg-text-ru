# Сайт tg-text.ru

Проект сайта для домена tg-text.ru

## Структура проекта

- `index.html` - главная страница сайта
- `app.js` - Node.js API сервер для обработки текста
- `package.json` - зависимости Node.js проекта
- `nginx_tg-text.ru.conf` - конфигурация nginx для сервера
- `deploy.ps1` / `deploy.bat` - скрипт для автоматического деплоя на сервер (включает функции отката)
- `post-receive` - Git hook для автоматического обновления сайта на сервере
- `setup_mysql.sh` - скрипт установки MySQL на сервере
- `init_database.sql` - SQL скрипт для создания базы данных
- `MYSQL_SETUP.md` - инструкция по установке MySQL
- `SSL/` - SSL сертификаты для домена

## Быстрый старт

### Обновление сайта

Для обновления сайта на сервере просто выполните:

```powershell
.\deploy.ps1
```

Или через батник (двойной клик):
```
.\deploy.bat
```

Или вручную через Git:

```powershell
git add .
git commit -m "Описание изменений"
git push production main
```

Сайт обновится автоматически без прерывания работы благодаря Git hook!

### Откат на одну версию назад

Если нужно откатить проект на одну версию назад:

```powershell
.\deploy.ps1 -RollbackBack
```

Скрипт покажет текущую и предыдущую версию и выполнит откат с автоматической отправкой на сервер.

### Возврат к последней версии (откат вперед)

Если нужно вернуться к последней версии после отката назад:

```powershell
.\deploy.ps1 -RollbackForward
```

Скрипт найдет последнюю версию в истории (до отката) и вернет проект к ней с автоматической отправкой на сервер.

## Сервер

- **IP:** 45.153.70.209
- **Домен:** tg-text.ru
- **ОС:** Arch Linux
- **Web сервер:** Nginx
- **API сервер:** Node.js (Express) на порту 5000
- **База данных:** MySQL (tg_text_db)
- **Путь на сервере:** /var/www/tg-text.ru/public_html

## Особенности

✅ Автоматический деплой через Git без прерывания работы сайта  
✅ SSL/HTTPS поддержка  
✅ Graceful reload nginx (без обрыва соединений)  
✅ Современные настройки безопасности  
✅ MySQL база данных для хранения истории запросов  
✅ API для обработки текста с сохранением в БД  

## Команды

```powershell
# Проверить статус Git
git status

# Посмотреть историю коммитов
git log --oneline

# Обычный деплой
.\deploy.ps1

# Откат на одну версию назад
.\deploy.ps1 -RollbackBack

# Возврат к последней версии (после отката)
.\deploy.ps1 -RollbackForward

# Отправить изменения на сервер вручную
git push production main

# Установка MySQL на сервере
ssh root@45.153.70.209
cd /var/www/tg-text.ru
chmod +x setup_mysql.sh
./setup_mysql.sh

# Или вручную:
mysql -u root -p < init_database.sql
```

## База данных MySQL

Проект использует MySQL для хранения истории запросов пользователей.

### Установка MySQL

Подробная инструкция в файле `MYSQL_SETUP.md`.

Быстрая установка:
```bash
ssh root@45.153.70.209
cd /var/www/tg-text.ru
chmod +x setup_mysql.sh
./setup_mysql.sh
```

### Структура базы данных

- **База данных:** `tg_text_db`
- **Пользователь:** `tg_text_user`
- **Таблица:** `user_requests` - хранит все запросы пользователей

### API Endpoints

- `POST /api/process` - обработка текста (автоматически сохраняет в БД)
- `GET /api/history` - история запросов текущего пользователя
- `GET /api/all-requests` - все запросы (административный)
- `GET /api/health` - проверка работоспособности (включая БД)
